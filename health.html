<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>健康調查</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    [v-cloak] { display: none; }
  </style>
</head>
<body>
  <div id="app" v-cloak>
    <!-- 頂部導覽列 -->
    <div v-if="!submitted" class="fixed top-0 right-0 p-4 md:p-6 z-50 flex items-center gap-3 md:gap-4">
      <div class="bg-white px-4 py-2 md:px-6 md:py-3 rounded-xl shadow-md flex items-center">
        <svg class="w-5 h-5 md:w-6 md:h-6 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        <span class="text-lg md:text-xl font-semibold text-gray-700">{{ displayName }}</span>
      </div>
      <button @click="handleLogout" class="flex items-center text-gray-600 hover:text-red-600 text-lg md:text-xl font-medium bg-white px-4 py-2 md:px-6 md:py-3 rounded-xl shadow-md hover:shadow-lg transition-all">
        <svg class="w-5 h-5 md:w-6 md:h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
        登出
      </button>
    </div>

    <!-- 成功提示頁面 -->
    <div v-if="submitted" class="min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-4">
      <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12 text-center max-w-md">
        <svg class="w-20 h-20 md:w-24 md:h-24 text-green-500 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">送出成功！</h2>
        <p class="text-xl md:text-2xl text-gray-600 mb-6">感謝您的填寫</p>
        <a href="index.html" class="inline-block bg-blue-500 hover:bg-blue-600 text-white text-xl md:text-2xl font-bold px-8 py-4 rounded-xl transition-all">
          返回首頁
        </a>
      </div>
    </div>

    <!-- 表單頁面 -->
    <div v-else class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-8 pb-32">
      <div class="max-w-3xl mx-auto">
        <a href="index.html" class="flex items-center text-blue-600 hover:text-blue-700 mb-6 text-xl md:text-2xl font-medium">
          <svg class="w-6 h-6 md:w-7 md:h-7 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          返回首頁
        </a>

        <div class="bg-white rounded-3xl shadow-xl p-6 md:p-10">
          <div class="mb-8">
            <div class="bg-blue-500 w-16 h-16 md:w-20 md:h-20 rounded-2xl mb-4 flex items-center justify-center text-white text-3xl md:text-4xl font-bold">
              健
            </div>
            <h1 class="text-3xl md:text-5xl font-bold text-gray-800 mb-2">健康調查</h1>
            <p class="text-xl md:text-2xl text-gray-600 mb-4">第 {{ currentPage }} / 3 頁</p>
            
            <!-- 進度條 -->
            <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
              <div class="bg-blue-500 h-3 rounded-full transition-all duration-300" :style="{width: (currentPage/3*100) + '%'}"></div>
            </div>
          </div>

          <!-- 第一頁：基本資料 -->
          <div v-show="currentPage === 1" class="space-y-6 md:space-y-8">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">1. 基本資料</h2>

            <!-- 身分證 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                身分證字號 <span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.idNumber"
                type="text"
                maxlength="10"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：A123456789"
              />
              <p v-if="errors.idNumber" class="mt-2 text-lg text-red-500">{{ errors.idNumber }}</p>
            </div>

            <!-- 姓名 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                姓名 <span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.name"
                type="text"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請輸入您的姓名"
              />
              <p v-if="errors.name" class="mt-2 text-lg text-red-500">{{ errors.name }}</p>
            </div>

            <!-- 性別 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                性別 <span class="text-red-500">*</span>
              </label>
              <div class="space-y-3">
                <label v-for="option in ['男', '女']" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.gender"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <p v-if="errors.gender" class="mt-2 text-lg text-red-500">{{ errors.gender }}</p>
            </div>

            <!-- 出生日期 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                出生日期 <span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.birthDate"
                type="date"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
              />
              <p v-if="errors.birthDate" class="mt-2 text-lg text-red-500">{{ errors.birthDate }}</p>
            </div>

            <!-- 就業別 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                就業別 <span class="text-red-500">*</span>
              </label>
              <div class="space-y-3">
                <label v-for="option in employmentTypes" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.employment"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <input
                v-if="formData.employment === '其他'"
                v-model="formData.employmentOther"
                type="text"
                class="w-full mt-3 px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明"
              />
              <p v-if="errors.employment" class="mt-2 text-lg text-red-500">{{ errors.employment }}</p>
            </div>

            <!-- 主要照顧者 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                主要照顧者 <span class="text-red-500">*</span>
              </label>
              <div class="space-y-3">
                <label v-for="option in caregivers" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.caregiver"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <input
                v-if="formData.caregiver === '其他'"
                v-model="formData.caregiverOther"
                type="text"
                class="w-full mt-3 px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明"
              />
              <p v-if="errors.caregiver" class="mt-2 text-lg text-red-500">{{ errors.caregiver }}</p>
            </div>

            <!-- 居住縣市 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                居住縣市 <span class="text-red-500">*</span>
              </label>
              <select
                v-model="formData.city"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all bg-white"
              >
                <option value="">請選擇縣市</option>
                <option v-for="city in cities" :key="city" :value="city">{{ city }}</option>
              </select>
              <p v-if="errors.city" class="mt-2 text-lg text-red-500">{{ errors.city }}</p>
            </div>

            <!-- 居住地區 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                居住地區 <span class="text-red-500">*</span>
              </label>
              <select
                v-model="formData.district"
                :disabled="!formData.city"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all bg-white disabled:bg-gray-100 disabled:cursor-not-allowed"
              >
                <option value="">{{ formData.city ? '請選擇鄉鎮區' : '請先選擇縣市' }}</option>
                <option v-for="district in availableDistricts" :key="district" :value="district">{{ district }}</option>
              </select>
              <p v-if="errors.district" class="mt-2 text-lg text-red-500">{{ errors.district }}</p>
            </div>

            <!-- 家庭生命週期 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                家庭生命週期 <span class="text-red-500">*</span>
              </label>
              <div class="space-y-3">
                <label v-for="option in familyLifeCycles" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.familyLifeCycle"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <input
                v-if="formData.familyLifeCycle === '其他'"
                v-model="formData.familyLifeCycleOther"
                type="text"
                class="w-full mt-3 px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明"
              />
              <p v-if="errors.familyLifeCycle" class="mt-2 text-lg text-red-500">{{ errors.familyLifeCycle }}</p>
            </div>

            <!-- 慢性病史 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                慢性病史（可複選，非必填）
              </label>
              <div class="space-y-3">
                <label v-for="option in chronicDiseases" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.chronicDiseaseList"
                    type="checkbox"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 rounded focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <input
                v-if="formData.chronicDiseaseList.includes('其他')"
                v-model="formData.chronicDiseaseOther"
                type="text"
                class="w-full mt-3 px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明其他慢性病"
              />
            </div>
          </div>

          <!-- 第二頁：醫療病史及菸酒檳習慣 -->
          <div v-show="currentPage === 2" class="space-y-6 md:space-y-8">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">2. 醫療病史及菸酒檳習慣</h2>

            <!-- 長期藥物使用 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                長期藥物使用（使用達3個月或以上，可複選，非必填）
              </label>
              <div class="space-y-3">
                <label v-for="option in medications" :key="option" class="flex items-center cursor-pointer group">
                  <input
                    v-model="formData.medicationList"
                    type="checkbox"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 rounded focus:ring-4 focus:ring-blue-200 cursor-pointer"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
              <input
                v-if="formData.medicationList.includes('其他')"
                v-model="formData.medicationOther"
                type="text"
                class="w-full mt-3 px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明其他藥物"
              />
            </div>

            <!-- 食物過敏史 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                食物過敏史（非必填）
              </label>
              <input
                v-model="formData.foodAllergy"
                type="text"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明食物過敏史"
              />
            </div>

            <!-- 藥物過敏史 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                藥物過敏史（非必填）
              </label>
              <input
                v-model="formData.drugAllergy"
                type="text"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="請說明藥物過敏史"
              />
            </div>

            <!-- 抽菸 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                抽菸（非必填）
              </label>
              <div class="space-y-3">
                <label v-for="option in smokingOptions" :key="option" class="flex items-start cursor-pointer group">
                  <input
                    v-model="formData.smoking"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer mt-1"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
            </div>

            <!-- 喝酒 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                喝酒（非必填）
              </label>
              <div class="space-y-3">
                <label v-for="option in drinkingOptions" :key="option" class="flex items-start cursor-pointer group">
                  <input
                    v-model="formData.drinking"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer mt-1"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
            </div>

            <!-- 嚼檳榔 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-4">
                嚼檳榔（非必填）
              </label>
              <div class="space-y-3">
                <label v-for="option in betelNutOptions" :key="option" class="flex items-start cursor-pointer group">
                  <input
                    v-model="formData.betelNut"
                    type="radio"
                    :value="option"
                    class="w-7 h-7 md:w-8 md:h-8 text-blue-600 focus:ring-4 focus:ring-blue-200 cursor-pointer mt-1"
                  />
                  <span class="ml-4 text-xl md:text-2xl text-gray-700 group-hover:text-blue-600 transition-colors">
                    {{ option }}
                  </span>
                </label>
              </div>
            </div>
          </div>

          <!-- 第三頁：身體檢查 -->
          <div v-show="currentPage === 3" class="space-y-6 md:space-y-8">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">3. 身體檢查</h2>

            <!-- 身高 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                身高（cm）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.height"
                type="number"
                step="0.1"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：170.5"
              />
              <p v-if="errors.height" class="mt-2 text-lg text-red-500">{{ errors.height }}</p>
            </div>

            <!-- 體重 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                體重（kg）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.weight"
                type="number"
                step="0.1"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：65.5"
              />
              <p v-if="errors.weight" class="mt-2 text-lg text-red-500">{{ errors.weight }}</p>
            </div>

            <!-- 血壓收縮壓 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                血壓收縮壓（mmHg）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.systolicBP"
                type="number"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：120"
              />
              <p v-if="errors.systolicBP" class="mt-2 text-lg text-red-500">{{ errors.systolicBP }}</p>
            </div>

            <!-- 血壓舒張壓 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                血壓舒張壓（mmHg）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.diastolicBP"
                type="number"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：80"
              />
              <p v-if="errors.diastolicBP" class="mt-2 text-lg text-red-500">{{ errors.diastolicBP }}</p>
            </div>

            <!-- 腰圍 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                腰圍（cm）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.waist"
                type="number"
                step="0.1"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：85.5"
              />
              <p v-if="errors.waist" class="mt-2 text-lg text-red-500">{{ errors.waist }}</p>
            </div>

            <!-- 脈搏 -->
            <div>
              <label class="block text-xl md:text-2xl font-semibold text-gray-700 mb-3">
                脈搏（次/每分鐘）<span class="text-red-500">*</span>
              </label>
              <input
                v-model="formData.pulse"
                type="number"
                class="w-full px-5 py-4 md:px-6 md:py-5 text-xl md:text-2xl border-3 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"
                placeholder="例：72"
              />
              <p v-if="errors.pulse" class="mt-2 text-lg text-red-500">{{ errors.pulse }}</p>
            </div>
          </div>

          <!-- 導航按鈕 -->
          <div class="flex justify-between items-center mt-8 pt-6 border-t-2 border-gray-200">
            <button
              v-if="currentPage > 1"
              @click="previousPage"
              class="flex items-center bg-gray-200 hover:bg-gray-300 text-gray-700 text-xl md:text-2xl font-bold px-6 py-4 md:px-8 md:py-5 rounded-xl transition-all"
            >
              <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              上一頁
            </button>
            <div v-else></div>

            <button
              v-if="currentPage < 3"
              @click="nextPage"
              class="flex items-center bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-xl md:text-2xl font-bold px-6 py-4 md:px-8 md:py-5 rounded-xl shadow-lg hover:shadow-xl transition-all"
            >
              下一頁
              <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>

            <button
              v-else
              @click="handleSubmit"
              class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white text-xl md:text-2xl font-bold px-6 py-4 md:px-8 md:py-5 rounded-xl shadow-lg hover:shadow-xl transition-all"
            >
              送出資料
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          currentPage: 1,
          submitted: false,
          displayName: 'XXX',
          formData: {
            // 第一頁：基本資料
            idNumber: '',
            name: '',
            gender: '',
            birthDate: '',
            employment: '',
            employmentOther: '',
            caregiver: '',
            caregiverOther: '',
            city: '',
            district: '',
            familyLifeCycle: '',
            familyLifeCycleOther: '',
            chronicDiseaseList: [],
            chronicDiseaseOther: '',
            // 第二頁：醫療病史
            medicationList: [],
            medicationOther: '',
            foodAllergy: '',
            drugAllergy: '',
            smoking: '',
            drinking: '',
            betelNut: '',
            // 第三頁：身體檢查
            height: '',
            weight: '',
            systolicBP: '',
            diastolicBP: '',
            waist: '',
            pulse: ''
          },
          errors: {},
          cities: ['台北市', '新北市', '桃園市', '台中市', '台南市', '高雄市', '基隆市', '新竹市', '新竹縣', '苗栗縣', '彰化縣', '南投縣', '雲林縣', '嘉義市', '嘉義縣', '屏東縣', '宜蘭縣', '花蓮縣', '台東縣', '澎湖縣', '金門縣', '連江縣'],
          districts: {
            '台北市': ['中正區', '大同區', '中山區', '松山區', '大安區', '萬華區', '信義區', '士林區', '北投區', '內湖區', '南港區', '文山區'],
            '新北市': ['板橋區', '三重區', '中和區', '永和區', '新莊區', '新店區', '樹林區', '鶯歌區', '三峽區', '淡水區', '汐止區', '瑞芳區', '土城區', '蘆洲區', '五股區', '泰山區', '林口區', '深坑區', '石碇區', '坪林區', '三芝區', '石門區', '八里區', '平溪區', '雙溪區', '貢寮區', '金山區', '萬里區', '烏來區'],
            '桃園市': ['桃園區', '中壢區', '平鎮區', '八德區', '楊梅區', '蘆竹區', '大溪區', '龍潭區', '龜山區', '大園區', '觀音區', '新屋區', '復興區'],
            '台中市': ['中區', '東區', '南區', '西區', '北區', '北屯區', '西屯區', '南屯區', '太平區', '大里區', '霧峰區', '烏日區', '豐原區', '后里區', '石岡區', '東勢區', '和平區', '新社區', '潭子區', '大雅區', '神岡區', '大肚區', '沙鹿區', '龍井區', '梧棲區', '清水區', '大甲區', '外埔區', '大安區'],
            '台南市': ['中西區', '東區', '南區', '北區', '安平區', '安南區', '永康區', '歸仁區', '新化區', '左鎮區', '玉井區', '楠西區', '南化區', '仁德區', '關廟區', '龍崎區', '官田區', '麻豆區', '佳里區', '西港區', '七股區', '將軍區', '學甲區', '北門區', '新營區', '後壁區', '白河區', '東山區', '六甲區', '下營區', '柳營區', '鹽水區', '善化區', '大內區', '山上區', '新市區', '安定區'],
            '高雄市': ['新興區', '前金區', '苓雅區', '鹽埕區', '鼓山區', '旗津區', '前鎮區', '三民區', '楠梓區', '小港區', '左營區', '仁武區', '大社區', '岡山區', '路竹區', '阿蓮區', '田寮區', '燕巢區', '橋頭區', '梓官區', '彌陀區', '永安區', '湖內區', '鳳山區', '大寮區', '林園區', '鳥松區', '大樹區', '旗山區', '美濃區', '六龜區', '內門區', '杉林區', '甲仙區', '桃源區', '那瑪夏區', '茂林區', '茄萣區'],
            '基隆市': ['仁愛區', '信義區', '中正區', '中山區', '安樂區', '暖暖區', '七堵區'],
            '新竹市': ['東區', '北區', '香山區'],
            '新竹縣': ['竹北市', '竹東鎮', '新埔鎮', '關西鎮', '湖口鄉', '新豐鄉', '芎林鄉', '橫山鄉', '北埔鄉', '寶山鄉', '峨眉鄉', '尖石鄉', '五峰鄉'],
            '苗栗縣': ['苗栗市', '頭份市', '竹南鎮', '後龍鎮', '通霄鎮', '苑裡鎮', '卓蘭鎮', '大湖鄉', '公館鄉', '銅鑼鄉', '南庄鄉', '頭屋鄉', '三義鄉', '西湖鄉', '造橋鄉', '三灣鄉', '獅潭鄉', '泰安鄉'],
            '彰化縣': ['彰化市', '員林市', '和美鎮', '鹿港鎮', '溪湖鎮', '二林鎮', '田中鎮', '北斗鎮', '花壇鄉', '芬園鄉', '大村鄉', '永靖鄉', '伸港鄉', '線西鄉', '福興鄉', '秀水鄉', '埔心鄉', '埔鹽鄉', '大城鄉', '芳苑鄉', '竹塘鄉', '社頭鄉', '二水鄉', '田尾鄉', '埤頭鄉', '溪州鄉'],
            '南投縣': ['南投市', '埔里鎮', '草屯鎮', '竹山鎮', '集集鎮', '名間鄉', '鹿谷鄉', '中寮鄉', '魚池鄉', '國姓鄉', '水里鄉', '信義鄉', '仁愛鄉'],
            '雲林縣': ['斗六市', '斗南鎮', '虎尾鎮', '西螺鎮', '土庫鎮', '北港鎮', '古坑鄉', '大埤鄉', '莿桐鄉', '林內鄉', '二崙鄉', '崙背鄉', '麥寮鄉', '東勢鄉', '褒忠鄉', '台西鄉', '元長鄉', '四湖鄉', '口湖鄉', '水林鄉'],
            '嘉義市': ['東區', '西區'],
            '嘉義縣': ['太保市', '朴子市', '布袋鎮', '大林鎮', '民雄鄉', '溪口鄉', '新港鄉', '六腳鄉', '東石鄉', '義竹鄉', '鹿草鄉', '水上鄉', '中埔鄉', '竹崎鄉', '梅山鄉', '番路鄉', '大埔鄉', '阿里山鄉'],
            '屏東縣': ['屏東市', '潮州鎮', '東港鎮', '恆春鎮', '萬丹鄉', '長治鄉', '麟洛鄉', '九如鄉', '里港鄉', '鹽埔鄉', '高樹鄉', '萬巒鄉', '內埔鄉', '竹田鄉', '新埤鄉', '枋寮鄉', '新園鄉', '崁頂鄉', '林邊鄉', '南州鄉', '佳冬鄉', '琉球鄉', '車城鄉', '滿州鄉', '枋山鄉', '三地門鄉', '霧台鄉', '瑪家鄉', '泰武鄉', '來義鄉', '春日鄉', '獅子鄉', '牡丹鄉'],
            '宜蘭縣': ['宜蘭市', '羅東鎮', '蘇澳鎮', '頭城鎮', '礁溪鄉', '壯圍鄉', '員山鄉', '冬山鄉', '五結鄉', '三星鄉', '大同鄉', '南澳鄉'],
            '花蓮縣': ['花蓮市', '鳳林鎮', '玉里鎮', '新城鄉', '吉安鄉', '壽豐鄉', '光復鄉', '豐濱鄉', '瑞穗鄉', '富里鄉', '秀林鄉', '萬榮鄉', '卓溪鄉'],
            '台東縣': ['台東市', '成功鎮', '關山鎮', '卑南鄉', '鹿野鄉', '池上鄉', '東河鄉', '長濱鄉', '太麻里鄉', '大武鄉', '綠島鄉', '海端鄉', '延平鄉', '金峰鄉', '達仁鄉', '蘭嶼鄉'],
            '澎湖縣': ['馬公市', '湖西鄉', '白沙鄉', '西嶼鄉', '望安鄉', '七美鄉'],
            '金門縣': ['金城鎮', '金湖鎮', '金沙鎮', '金寧鄉', '烈嶼鄉', '烏坵鄉'],
            '連江縣': ['南竿鄉', '北竿鄉', '莒光鄉', '東引鄉']
          },
          employmentTypes: ['退休', '農', '軍公教', '工', '商', '服務業', '家管', '無', '其他'],
          caregivers: ['父', '母', '監護人', '本人', '子女', '外勞', '其他'],
          familyLifeCycles: ['新婚夫婦', '第一個小孩誕生', '有學齡兒童', '有青少年子女', '子女外出創業', '空巢', '老化的家庭', '其他'],
          chronicDiseases: ['1.高血壓', '2.糖尿病', '3.腎臟病', '4.缺血性心臟病', '5.心律不整', '6.心臟衰竭', '7.腦血管疾病', '8.腫瘤', '9.貧血', '10.關節炎', '11.高膽固醇血症', '12.痛風或高尿酸血症', '13.過敏性鼻炎', '14.氣喘', '15.慢性肺疾病', '16.消化性腫瘤', '17.功能性腸胃問題', '其他'],
          medications: ['降血壓藥', '胰島素', '降血糖藥', '降血脂藥', '降尿酸藥', 'NSAID', '中草藥', '其他'],
          smokingOptions: ['1.無', '2.偶爾交際應酬', '3.平均一天吸約10支菸以下', '4.平均一天吸約10支菸(含)以上'],
          drinkingOptions: ['1.無', '2.偶爾交際應酬(每周1-2天)', '3.經常喝(每周1-2天)'],
          betelNutOptions: ['1.無', '2.偶爾交際應酬(每周1-2天)', '3.經常嚼或習慣在嚼(每周>2天)']
        };
      },
      mounted() {
        this.checkLogin();
        this.displayName = sessionStorage.getItem('displayName') || 'XXX';
      },
      computed: {
        availableDistricts() {
          return this.formData.city ? this.districts[this.formData.city] : [];
        }
      },
      watch: {
        'formData.city'(newCity) {
          this.formData.district = '';
        }
      },
      methods: {
        checkLogin() {
          const isLoggedIn = sessionStorage.getItem('isLoggedIn');
          if (isLoggedIn !== 'true') {
            window.location.href = 'login.html';
          }
        },
        handleLogout() {
          if (confirm('確定要登出嗎？')) {
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('username');
            sessionStorage.removeItem('displayName');
            window.location.href = 'login.html';
          }
        },
        nextPage() {
          if (this.validateCurrentPage()) {
            this.currentPage++;
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } else {
            const firstError = document.querySelector('.text-red-500');
            if (firstError) {
              firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          }
        },
        previousPage() {
          this.currentPage--;
          window.scrollTo({ top: 0, behavior: 'smooth' });
        },
        validateCurrentPage() {
          this.errors = {};
          
          if (this.currentPage === 1) {
            if (!this.formData.idNumber.trim()) this.errors.idNumber = '請輸入身分證字號';
            if (!this.formData.name.trim()) this.errors.name = '請輸入姓名';
            if (!this.formData.gender) this.errors.gender = '請選擇性別';
            if (!this.formData.birthDate) this.errors.birthDate = '請選擇出生日期';
            if (!this.formData.employment) this.errors.employment = '請選擇就業別';
            if (!this.formData.caregiver) this.errors.caregiver = '請選擇主要照顧者';
            if (!this.formData.city) this.errors.city = '請選擇居住縣市';
            if (!this.formData.district) this.errors.district = '請選擇居住地區';
            if (!this.formData.familyLifeCycle) this.errors.familyLifeCycle = '請選擇家庭生命週期';
          } else if (this.currentPage === 2) {
            // 第二頁都是非必填，不需驗證
          } else if (this.currentPage === 3) {
            if (!this.formData.height) this.errors.height = '請輸入身高';
            if (!this.formData.weight) this.errors.weight = '請輸入體重';
            if (!this.formData.systolicBP) this.errors.systolicBP = '請輸入血壓收縮壓';
            if (!this.formData.diastolicBP) this.errors.diastolicBP = '請輸入血壓舒張壓';
            if (!this.formData.waist) this.errors.waist = '請輸入腰圍';
            if (!this.formData.pulse) this.errors.pulse = '請輸入脈搏';
          }
          
          return Object.keys(this.errors).length === 0;
        },
        async handleSubmit() {
          if (this.validateCurrentPage()) {
            try {
              // 顯示載入中
              const loadingMsg = document.createElement('div');
              loadingMsg.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-2xl shadow-2xl z-50';
              loadingMsg.innerHTML = `
                <div class="flex flex-col items-center">
                  <svg class="animate-spin h-12 w-12 text-blue-500 mb-4" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <p class="text-xl font-semibold text-gray-700">資料上傳中...</p>
                </div>
              `;
              document.body.appendChild(loadingMsg);

              // 送出資料到 PHP 後端
              const response = await fetch('save_health_survey.php', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(this.formData)
              });

              const result = await response.json();
              
              // 移除載入訊息
              document.body.removeChild(loadingMsg);

              if (result.success) {
                console.log('儲存成功：', result);
                this.submitted = true;
                window.scrollTo({ top: 0, behavior: 'smooth' });
              } else {
                alert('儲存失敗：' + result.message);
              }
              
            } catch (error) {
              console.error('送出錯誤：', error);
              alert('資料送出時發生錯誤，請稍後再試');
            }
          } else {
            const firstError = document.querySelector('.text-red-500');
            if (firstError) {
              firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>